add_newline = false

format = """
$hostname\
$nix_shell\
$directory\
$git_branch\
$git_commit\
${custom.jj}\
$git_state\
$git_status\
${custom.jjstatus}\
$hg_branch\
$docker_context\
$conda\
$jobs\
$cmd_duration\
$status\
$character
"""

[hostname]
# ssh_only = false
format = "[$hostname]($style) "

[character]
success_symbol = "[\\$](bold green)"
error_symbol = "[\\$](bold red)"
vicmd_symbol = "[\\$](bold blue)"

[git_branch]
format = "[$symbol$branch]($style) "

[git_status]
conflicted = "!"
ahead = "↑"
behind = "↓"
diverged = "%"
untracked = "u"
stashed = "\\$"
modified = "~"
staged = "+"
renamed = "~"
deleted = "-"
style = "bold purple"

[custom.jj]
when = "jj --ignore-working-copy root"
symbol = '[\(JJ\)](purple) '

[custom.jjstatus]
command = '''
jj log --revisions @ --limit 1 --ignore-working-copy --no-graph --color always  --template '
  separate(" ",
    bookmarks.map(|x| truncate_end(10, x.name(), "…")).join(" "),
    tags.map(|x| truncate_end(10, x.name(), "…")).join(" "),
    surround("\"", "\"", truncate_end(12, description.first_line(), "…")),
    if(conflict, "conflict"),
    if(divergent, "divergent"),
    if(hidden, "hidden"),
    if(immutable, "immutable"),
  )
'
'''
when = "jj --ignore-working-copy root"
symbol = ''

# [custom.jjstate]
# when = "jj --ignore-working-copy root"
# command = '''
# jj log -r@ -n1 --ignore-working-copy --no-graph -T "" --stat | tail -n1 | sd "(\d+) files? changed, (\d+) insertions?\(\+\), (\d+) deletions?\(-\)" ' ${1}m ${2}+ ${3}-' | sd " 0." ""
# '''

[jobs]
format = "[$symbol$number]($style) "
#symbol = ": "
symbol = "+"

[status]
disabled = false
symbol = "✗ "

[nix_shell]
# format = '[$symbol($name)]($style) '
format = '[$symbol]($style) '
symbol = " "
